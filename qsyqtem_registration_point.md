# Пункт регистрации #


&lt;hr&gt;


Пункт регистрации это комплекс в который входят компоненты:
  * компьютер с сенсорным экраном для выбора услуги
  * принтер для печати талонов на обслуживание
  * в дальнейшем возможно оснащение сканером штрихкодов для определения ранее записавшихся клиентов
  * вандалозащищенный корпус для установки в соответствующем месте

Компьютер соединен с сервером системы по сети и получает все необходимые сетевые параметры из командной строки

**java -cp dist/QSystem.jar ru.apertum.qsystem.client.forms.FWelcome -sport 3128 -cport 3129 -s 192.168.0.43 tach/buttons**

-_sport 3128_ порт сервера<br>
-<i>cport 3129</i> порт пункта регистрации для приема команд от сервера для управления доступом к регистрации<br>
-<i>s 192.168.0.43</i> адрес сервера системы<br>
-<i>tach/buttons</i> это выбор режима пункта регистрации tach - тачевый визуальный пункт регистрации, buttons - пункт регистрации в виде нескольких хардварных кнопок на COM-порту<br>
можно указать еще два необязательных ключа, это debug, med и super<br>
<i>debug</i> не развертывает окно регистрации на весь экран и не прячет курсор, при этом в консольном окне видны все логи<br>
<i>super</i> требуется если пункт регистрации работает с доменом через суперсайт<br>
<br>
<h2>Архитектура</h2>
<br>
<br>
<hr><br>
<br>
<br>
Состоит из класса формы и классов отдельно реализованных кнопок и панелей. Имеет свой TCP-сервер для приема управляющих заданий. Метод печати реализован как статичный метод формы и запускается отдельным потоком из обработчика нажатия кнопки выбора услуги. Диалоговые панели реализованы отдельно и показываются по таймерам. При каждом действии пункт регистрации опрашивает сервер и может выполнять ряд команд управления, таких как блокировка/разблокировка, опрос состояния, реинициализация.<br>
Если пункт регистрации работает в режиме <i>buttons</i>, то визуальные формы не создаются. Программа представляет собой консольное окно с индикатором активности. Вся логика работы сосредоточена в методе <b>main</b>.<br>
<h3>Электронная регистратура</h3>

Включается указанием параметра <i>med</i> при старте приложения. При этом на передний план выходит форма считывания или ввода номера страхового полиса. При корректном вводе форма ввода исчезает и появляется стандартное окно в режиме предварительной записи.<br>
<br>
<h2>Реализация</h2>
<br>
<br>
<hr><br>
<br>
<br>
Класс формы <b>public class FWelcome extends javax.swing.JFrame.<br>
Сервер приема команд реализован как внутренний класс</b>private class CommandServer implements Runnable<b>.<br>
Класс кнопки пользователя при выборе услуги</b>public class QButton extends JButton<b>. Кнопка умеет слать задание на сервер для постановки в очередь.<br>
Класс панели</b>public class QPanel extends JPanel implements Serializable<b>с перекрытым методом</b>painComponent()<b>. Панель может проигрывать фидеофайлы</b>.mpg, <b>.jpg. Для этого используется установленная предварительно на компьютере среда</b>JMF<b>.<br>
Метод печати квитанции</b>public static synchronized void printTicket(Element elTicket)<b>. Вызывается а отдельном потоке, токорый стартует из метода обработки нажатия кнопки</b>QButton<b>.</b>

В режиме <i>buttons</i> кнопки присылают в COM-порт сообщение <b>pressed button n</b>, где n - номер нажатой кнопки. Чтобы по этой строке пункт регистрации обнаружил необходимую услугу, требуется настроить услуги особым образом. Т.е. В каждой услуге в поле <i>"Надпись на кнопке"</i> прописать строчку, на которую эта услуга будет отзываться, в нашем случае это <b>pressed button n</b>.<br>
<br>
<h2>Настройка</h2>
<br>
<br>
<hr><br>
<br>
<br>
Настройки пункта регистрации хранятся в файле <i>config/welcome.properties</i>. Загружается этот файл при создании формы вызовом метода <b>private void loadSettings()</b>.<br>
Настройки пункта регистрации:<br>
<ul><li><i>left_margin</i> - отступ слева на квитанции<br>
</li><li><i>top_margin</i> - отступ сверху на квитанции<br>
</li><li><i>line_heigth</i> - ширина строки<br>
</li><li><i>line_length</i> - длинна стоки на квитанции<br>
</li><li><i>scale_vertical</i> - масштабирование по вертикале<br>
</li><li><i>scale_horizontal</i> - масштабирование по горизонтале<br>
</li><li><i>logo</i> - присутствие логотипа на квитанции<br>
</li><li><i>barcode</i> - присутствие штрихкода на квитанции<br>
</li><li><i>logo_left</i> - отступ печати логотипа слева<br>
</li><li><i>logo_top</i> - отступ печати логотипа сверху<br>
</li><li><i>delay_print</i> - задержка заставки при печати в мсек.<br>
</li><li><i>delay_back</i> - задержка при выборе услуги до возврата в главное меню и при диалоге согласия встать в очередь в мсек.<br>
</li><li><i>ask_limit</i> - критический размер очереди после которого спрашивать клиентов о готовности встать в очередь<br>
</li><li><i>logo_img</i> - графический файл или ресурс с логотипом<br>
</li><li><i>promo_text</i> - промотекст, печатающийся мелким шрифтом перед штрихкодом.<br>
</li><li><i>bottom_text</i> - произвольный текст, печатающийся в конце квитанции после штрихкода<br>
</li><li><i>buttons_COM</i> - название СОМ-порта, при использовании кнопочного пункта регистрации<br>
</li><li><i>buttons_databits</i> - параметр СОМ-порта, при использовании кнопочного пункта регистрации<br>
</li><li><i>buttons_speed</i> - параметр СОМ-порта, при использовании кнопочного пункта регистрации<br>
</li><li><i>buttons_parity</i> - параметр СОМ-порта, при использовании кнопочного пункта регистрации<br>
</li><li><i>buttons_stopbits</i> - параметр СОМ-порта, при использовании кнопочного пункта регистрации<br>
</li><li><i>info_button</i> - кнопка информационной системы на пункте регистрации<br>
</li><li><i>response_button</i> - кнопка обратной связи на пункте регистрации<br>
</li><li><i>advance_button</i> - кнопка предварительной записи на пункте регистрации</li></ul>

В качестве логотипа на талоне по умолчанию можно использовать изображение из ресурсов /ru/ccrs/client/forms/resources/logo_ticket.png.<br>
Штрихкод содержит идентификатор клиента, который в последствии будет ID в СУБД.