# Архитектура проекта #

Архитектура проекта имеет три уровня. Это клиентский уровень, сервер и хранилище информации(СУБД или XML-файл  конфигурации). Клиентские приложения взаимодействует с сервером по средством TCP и UDP протоколов. Протокол верхнего уровня спроектирован и реализован с помощью XML.
  1. **Сервер.** При старте сервер занимает указанный в конфигурации порт и «слушает» его на протяжении всей работы системы. При этом сервер не имеет списка клиентов. При соединении с клиентом, сервер запускает отдельный поток, передает в него новое соединение и обрабатывает пришедшее задание. Причем при первом соединении сервер проверит не является ли это попыткой войти в систему под уже зарегистрированным пользователем, для этого опросится ранее региный юзер на предмет его существования. Задание представляет собой правильный XML-документ. Каждое XML-задание имеет атрибут с наименованием того что требуется выполнить и дополнительные атрибуты с входными параметрами. Сервер читает это наименование и достает из _HashMap_ нужный обработчик, задействует метод process обработчика и высылает XML-ответ обратно инициатору соединения. Ответ должен быть правильным XML-документом, т.к. на стороне клиента происходит парсинг ответа. Жестко заданного протокола для формирования XML-задания и ответа нет, это индивидуально для каждого задания.
  1. **Клиент.** Клиент имеет адрес и порт сервера для взаимодействия, передаются через параметры в командной строке. Формирование и отправка команд на сервер идет через статичные методы класса _NetCommander_. Вызывая определенный метод из этого класса и передавая параметры в ответ получаешь XML-ответ, в нем содержатся результаты выполнения команды или это может быть пустой, но правильный XML-документ. XML-документ задания формируется также в классе _NetCommander_, для этого в нем есть специальные константы, по одной на каждое задание.
  1. **Хранилище конфигурации.** С этим уровнем взаимодействует только сервер. Путь к XML-файлу конфигурации и настройки СУБД определяются в контексте фреймворка _Spring2.5_ в конфигурационном файле ru/ccrs/spring/qsContext.xml из QSystem.jar.
  1. **Отчетная подсистема.** Отчетная система построена на взаимодействии браузера и отчетного сервера. Браузер работает на стороне клиента обычным образом. Отчетный сервер входит в состав сервера системы и стартует на определенном в конфигурации порту при старте системы вместе с главным сервером приложений. Отчетный сервер, подобно обычному веб серверу обрабатывает запросы от браузера, генерирует отчеты, следит за правильностью регистрации в системе, формирует список отчетов, выдает построенные отчеты в браузер клиенту.